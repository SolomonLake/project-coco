(this["webpackJsonpdemo-react"]=this["webpackJsonpdemo-react"]||[]).push([[0],{117:function(e,t,a){"use strict";a.r(t);var r=a(161),n=a(160),c=a(0),o=a.n(c),u=a(15),i=a.n(u),s=(a(97),a(3)),l=a.n(s),p=a(119),d=a(151),m=function(){return o.a.createElement(d.a,{container:!0,direction:"column",justify:"center",alignItems:"center",spacing:5},o.a.createElement(d.a,{item:!0},o.a.createElement(p.a,null,"Loading")))},f=a(21),w=a(10),v=a(12),g=a(32),E=a.n(g);a(111);function I(){if(h)return h;throw new Error("config not initialized")}var h=null;function x(){if(y)return y;throw new Error("firestoreDb not initialized")}function b(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return E.a.initializeApp({apiKey:I().FIRESTORE_API_KEY,authDomain:I().FIRESTORE_AUTH_DOMAIN,projectId:I().FIRESTORE_PROJECT_ID}),t.next=3,l.a.awrap(E.a.auth().signInWithCustomToken(e).catch((function(e){var t=e.code,a=e.message;throw console.log("firestoreInitialize error",t,a),e})));case 3:y=E.a.firestore();case 4:case"end":return t.stop()}}))}var y=null,T=function(e){return{get:function(t){var a,r;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return a=x().collection(e).doc(t),n.next=3,l.a.awrap(a.get());case 3:if(!(r=n.sent).exists){n.next=8;break}return n.abrupt("return",r.data());case 8:return n.abrupt("return",null);case 9:case"end":return n.stop()}}))},set:function(t,a){return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a.awrap(x().collection(e).doc(t).set(a));case 2:case"end":return r.stop()}}))},update:function(t,a){return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a.awrap(x().collection(e).doc(t).update(a));case 2:case"end":return r.stop()}}))},delete:function(t){return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(x().collection(e).doc(t).delete());case 2:case"end":return a.stop()}}))},watch:function(t,a){return x().collection(e).doc(t).onSnapshot((function(e){a(e.data())}))},batch:function(){return x().batch()},docRef:function(t){return x().collection(e).doc(t)},collectionRef:function(t){return x().collection(e)}}},G=T("users"),S={watchUser:function(e,t){return G.watch(e,t)},getUser:function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.awrap(G.get(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},createUser:function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.awrap(G.set(e.userId,e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},findOrCreateUser:function(e){var t,a,r;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.awrap(S.getUser(e.id));case 2:if(!(t=n.sent)){n.next=10;break}return a=Object(w.a)({},t,{displayName:e.first_name+" "+e.last_name,personalMeetingUrl:e.personal_meeting_url,avatarUrl:e.pic_url}),n.next=7,l.a.awrap(G.update(a.userId,a));case 7:return n.abrupt("return",a);case 10:return r={userId:e.id,groupId:null,displayName:e.first_name+" "+e.last_name,personalMeetingUrl:e.personal_meeting_url,avatarUrl:e.pic_url,notificationQueue:{}},n.next=13,l.a.awrap(G.set(r.userId,r));case 13:return n.abrupt("return",r);case 14:case"end":return n.stop()}}))},updateGroup:function(e,t){return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(G.update(e,{groupId:t}));case 2:case"end":return a.stop()}}))},pushNotification:function(e,t){var a;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a=Object(v.a)({},"notificationQueue.".concat(t.notificationId),t),r.next=3,l.a.awrap(G.update(e,a));case 3:case"end":return r.stop()}}))},clearNotifications:function(e,t){var a;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a=G.batch(),t.map((function(t){var r=G.docRef(e);a.update(r,Object(v.a)({},"notificationQueue.".concat(t.notificationId),E.a.firestore.FieldValue.delete()))})),r.next=4,l.a.awrap(a.commit());case 4:case"end":return r.stop()}}))}};function U(e,t){for(var a="",r=0;r<e;r++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}var O=function(e,t){var a=Object.values(e);a.length>0&&(a.map((function(e){switch(e.type){case"openMeeting":window.open(e.meetingUrl,"_blank");break;default:console.log("unknown notification.type: ",e.type);e.type}})),S.clearNotifications(t,a))},A=function(e,t,a){return S.pushNotification(e,{type:"openMeeting",meetingUrl:a,from:"user",fromId:t,timestamp:Date.now(),notificationId:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))})},k={view:"initial"};function j(e,t){switch(console.log("appStoreReducer previous state:",e),console.log("appStoreReducer",t),t.type){case"TRANSITION_APP_STATE":return N(t.newAppState,e);case"UPDATE_USER":switch(e.view){case"joinGroup":case"mainGroup":return N(Object(w.a)({},e,{user:t.newUser}),e);case"initial":case"loading":return e;default:return e}default:return e}}function N(e,t){return console.log("appStoreReducer computed state",e),function(e,t){switch(e.view){case"joinGroup":case"mainGroup":O(e.user.notificationQueue,e.user.userId);break;case"initial":case"loading":break;default:}}(e),e}var D=o.a.createContext(null);var _={joinId:""};function C(e,t){switch(console.log("joinGroupStoreReducer previous state:",e),console.log("joinGroupStoreReducer",t),t.type){case"UPDATE_JOIN_ID":return a=Object(w.a)({},e,{joinId:t.newJoinId}),console.log("joinGroupStoreReducer computed state",a),a;default:t.type;return e}var a}o.a.createContext(null);var P=a(55),R=a(54),M=function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null},F=function(e,t){localStorage.setItem(e,JSON.stringify(t))},L=a(42),J=a.n(L),z=function(e){var t=J.a.parse(window.location.search.slice(1)),a=t?t[e]:null;return a instanceof Array?a[0]:a},B=function(e){var t=J.a.parse(window.location.search.slice(1)),a=(t[e],Object(P.a)(t,[e].map(R.a))),r=Object.keys(a).length>0?"?"+J.a.stringify(a):"";return window.location.origin+window.location.pathname+r},H=function(){if(M("popupsArentBlocked"))return!1;var e=window.open("","_blank");try{return!e||(e.close(),F("popupsArentBlocked",!0),!1)}catch(t){return!0}},K=a(162),Q=a(120),W=a(155),V=T("appGroups"),Y={watchAppGroup:function(e,t){return V.watch(e,t)},getAppGroup:function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.awrap(V.get(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},getExistingAppGroup:function(e){var t;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(V.get(e));case 2:if(!(t=a.sent)){a.next=7;break}return a.abrupt("return",t);case 7:throw new Error("getExistingAppGroup: group doesn't exist with id:"+e);case 8:case"end":return a.stop()}}))},deleteAppGroup:function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.awrap(V.delete(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},createAppGroup:function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.awrap(V.set(e.appGroupId,e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},createNewAppGroup:function(e){var t;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t={appGroupId:"G"+(r=5,U(r,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")).toUpperCase(),userIds:Object(v.a)({},e.userId,Object(w.a)({},e,{userId:e.userId,lastOnline:Date.now(),doNotDisturbUntil:0,currentMeeting:null,dailyCalendarEvents:null}))},a.next=3,l.a.awrap(V.set(t.appGroupId,t));case 3:return a.abrupt("return",t);case 4:case"end":return a.stop()}var r}))},userJoinExistingAppGroup:function(e,t){var a,r;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return a=Object(w.a)({},e,{userId:e.userId,lastOnline:Date.now(),doNotDisturbUntil:0,currentMeeting:null,dailyCalendarEvents:null}),r=Object(v.a)({},"userIds.".concat(e.userId),a),V.update(t,r),n.abrupt("return",Y.getExistingAppGroup(t));case 4:case"end":return n.stop()}}))},updateUserDoNotDistrubUntil:function(e,t,a){var r;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object(v.a)({},"userIds.".concat(t,".doNotDisturbUntil"),a),n.next=3,l.a.awrap(V.update(e,r));case 3:case"end":return n.stop()}}))},removeUserFromAppGroup:function(e,t){return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(V.update(e.appGroupId,Object(v.a)({},"userIds.".concat(t.userId),E.a.firestore.FieldValue.delete())));case 2:case"end":return a.stop()}}))},setUserCalendarEvents:function(e,t,a){var r=Object(v.a)({},"userIds.".concat(e,".dailyCalendarEvents"),a);V.update(t,r)},updateUser:function(e,t){var a,r=(a={},Object(v.a)(a,"userIds.".concat(e.userId,".avatarUrl"),e.avatarUrl),Object(v.a)(a,"userIds.".concat(e.userId,".displayName"),e.displayName),Object(v.a)(a,"userIds.".concat(e.userId,".groupId"),e.groupId),Object(v.a)(a,"userIds.".concat(e.userId,".personalMeetingUrl"),e.personalMeetingUrl),a);V.update(t,r)},sendAlivePing:function(e,t){var a=Object(v.a)({},"userIds.".concat(e,".lastOnline"),Date.now());V.update(t,a)}},q=a(18),Z=a.n(q),X=function(e){var t;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(Y.createNewAppGroup(e));case 2:return t=a.sent,a.next=5,l.a.awrap(S.updateGroup(e.userId,t.appGroupId));case 5:return a.abrupt("return",t);case 6:case"end":return a.stop()}}))},$=function(e,t){var a;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a.awrap(Y.getAppGroup(t));case 2:if(!r.sent){r.next=12;break}return r.next=6,l.a.awrap(Y.userJoinExistingAppGroup(e,t));case 6:return a=r.sent,r.next=9,l.a.awrap(S.updateGroup(e.userId,t));case 9:return r.abrupt("return",a);case 12:return r.abrupt("return",null);case 13:case"end":return r.stop()}}))},ee=function(e,t){var a;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a.awrap(S.updateGroup(e.userId,null));case 2:return r.next=4,l.a.awrap(Y.removeUserFromAppGroup(t,e));case 4:return r.next=6,l.a.awrap(Y.getAppGroup(t.appGroupId));case 6:if(!(a=r.sent)||!a.userIds||0!==Z.a.values(a.userIds).length){r.next=10;break}return r.next=10,l.a.awrap(Y.deleteAppGroup(a.appGroupId));case 10:case"end":return r.stop()}}))},te=function(e){var t=Object(c.useContext)(D),a=function(){var e=Object(c.useReducer)(C,_),t=Object(f.a)(e,2);return{state:t[0],dispatch:t[1]}}();return o.a.createElement(d.a,{container:!0,direction:"column",justify:"center",alignItems:"center",spacing:5},o.a.createElement(d.a,{item:!0},o.a.createElement(d.a,{container:!0,direction:"row",justify:"center",alignItems:"center",spacing:2},o.a.createElement(d.a,{item:!0},o.a.createElement(K.a,{label:"Group Id",margin:"normal",variant:"outlined",value:a.state.joinId,onChange:function(e){a.dispatch({type:"UPDATE_JOIN_ID",newJoinId:e.target.value.toUpperCase()})}})),o.a.createElement(d.a,{item:!0},o.a.createElement(Q.a,{color:"primary",variant:"contained",onClick:function(){var r;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),n.next=3,l.a.awrap($(e.appState.user,a.state.joinId));case 3:(r=n.sent)?t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:Object(w.a)({},e.appState.user,{groupId:r.appGroupId}),initialAppGroup:r,popupsBlocked:H()}}):(t.dispatch({type:"TRANSITION_APP_STATE",newAppState:e.appState}),console.log("group doesn't exist"));case 5:case"end":return n.stop()}}))}},"Join")))),o.a.createElement(W.a,{variant:"middle"}),o.a.createElement(d.a,{item:!0},o.a.createElement(Q.a,{color:"secondary",variant:"contained",onClick:function(){var a;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),r.next=3,l.a.awrap(X(e.appState.user));case 3:a=r.sent,t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:Object(w.a)({},e.appState.user,{groupId:a.appGroupId}),initialAppGroup:a,popupsBlocked:H()}});case 5:case"end":return r.stop()}}))}},"Create Group")))};function ae(e,t){switch(console.log("mainGroupStoreReducer previous state:",e),console.log("mainGroupStoreReducer",t),t.type){case"UPDATE_APP_GROUP":return re(Object(w.a)({},e,{appGroup:t.newAppGroup}));case"CHECK_FOR_MEETINGS_UI_UPDATE":return re(Object(w.a)({},e,{lastCheckForMeetingUIUpdate:Date.now()}));default:return e}}function re(e){return console.log("mainGroupStoreReducer computed state",e),e}o.a.createContext(null);var ne=null;var ce=function(){var e,t,a,r;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.awrap(l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ne){e.next=6;break}return e.next=3,l.a.awrap(ne);case 3:return e.abrupt("return",gapi.client);case 6:return ne=l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.awrap(new Promise((function(e,t){gapi.load("client:auth2",{callback:function(){var a,r;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a={apiKey:I().GOOGLE_CALENDAR_API_KEY,clientId:I().GOOGLE_AUTH_CLIENT_ID,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],scope:"https://www.googleapis.com/auth/calendar.events.readonly"},n.next=4,l.a.awrap(gapi.client.init(a));case 4:if((r=gapi.auth2.getAuthInstance()).isSignedIn.get()){n.next=9;break}return n.next=9,l.a.awrap(r.signIn());case 9:e(),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(0),ne=null,t(n.t0);case 16:case"end":return n.stop()}}),null,null,[[0,12]])}})})));case 2:case"end":return e.stop()}})),e.next=9,l.a.awrap(ne);case 9:return e.abrupt("return",gapi.client);case 10:case"end":return e.stop()}})));case 2:return e=n.sent,n.next=5,l.a.awrap(e.calendar.events.list({calendarId:"primary",timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"}));case 5:return t=n.sent,a=t.result,r=a.items||[],console.log("Upcoming events:",r),r.map((function(e){var t=e.start?e.start.dateTime||e.start.date:null;console.log(e.summary+" ("+t+")")})),n.abrupt("return",r);case 11:case"end":return n.stop()}}))},oe=function(e,t){var a,r;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.awrap(ce());case 2:a=n.sent,r=a.map(ue),Y.setUserCalendarEvents(e,t,r);case 5:case"end":return n.stop()}}))};function ue(e){var t=e.id,a=e.summary,r=e.start?e.start.dateTime||e.start.date:null,n=e.end?e.end.dateTime||e.end.date:null,c=e.htmlLink;if(t&&a&&r&&n&&c)return{id:t,eventName:a,startTime:r,endTime:n,eventLink:c};throw console.log("gapi calendar event",e),new Error("gapi calendar event is missing properties")}var ie=a(77),se=a.n(ie),le=a(121),pe=a(156),de=function(e){return e.toLocaleTimeString().slice(0,-6)+e.toLocaleTimeString().slice(-2)},me=function(e){var t=Math.floor(e/6e4),a=t%60,r=Math.floor(t/60);return(r>0?"".concat(r,":"):"")+(a<10?"0"+a:a)},fe=a(38),we=a.n(fe),ve=a(73),ge=a.n(ve),Ee=a(57),Ie=a(82),he={primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:Ee.a.A400}},xe="#fafafa",be="#303030",ye=a(164),Te=function(e){var t=e.user.doNotDisturbUntil<Date.now();return o.a.createElement("div",null,o.a.createElement(ye.a,{alt:e.user.displayName,src:e.user.avatarUrl}),"offline"!==e.section&&o.a.createElement("span",null,o.a.createElement("div",{style:{height:"10px",width:"10px",backgroundColor:e.darkTheme?be:xe,borderRadius:"50%",position:"absolute",transform:"translate(1.9em, -0.6em)"}}),o.a.createElement("div",{style:{height:"7px",width:"7px",backgroundColor:t?he.secondary.main:he.error.main,borderRadius:"50%",position:"absolute",transform:"translate(2.01em, -0.49em)"}})))},Ge=a(75),Se=a.n(Ge),Ue=a(74),Oe=a.n(Ue),Ae=a(72),ke=a.n(Ae),je=function(e){var t=e.mainGroupStore.state.appGroup.userIds[e.user.userId].dailyCalendarEvents,a=Object(c.useState)(Ne(e.user.doNotDisturbUntil,t)),r=Object(f.a)(a,2),n=r[0],u=r[1];o.a.useEffect((function(){u(Ne(e.user.doNotDisturbUntil,t));var a=setInterval((function(){u(Ne(e.user.doNotDisturbUntil,t))}),1e4);return function(){clearInterval(a)}}),[e.mainGroupStore.state.appGroup.userIds[e.user.userId].dailyCalendarEvents]),console.log(e.currentUser.personalMeetingUrl);var i=e.user.doNotDisturbUntil<Date.now();return o.a.createElement(d.a,{container:!0,direction:"row",spacing:2,justify:"flex-start",alignItems:"center",style:{flexWrap:"nowrap"}},o.a.createElement(d.a,{item:!0},o.a.createElement(Te,{user:e.user,section:e.section,darkTheme:e.darkTheme})),o.a.createElement(d.a,{item:!0,style:{flexGrow:1}},o.a.createElement(d.a,{container:!0,direction:"column",spacing:0,justify:"flex-start"},o.a.createElement(d.a,{item:!0},o.a.createElement(p.a,null,e.user.displayName)),e.showNextMeetingTime&&o.a.createElement(d.a,{item:!0},o.a.createElement(d.a,{container:!0,direction:"row",justify:"flex-start"},o.a.createElement(d.a,{item:!0},e.isCurrentUser&&"Calendar not synced"===n?o.a.createElement(p.a,{variant:"caption",color:"error"},o.a.createElement("i",null,n)):o.a.createElement(p.a,{variant:"caption"},o.a.createElement("i",null,n))),n.startsWith("Busy for ~")&&o.a.createElement(d.a,{item:!0,justify:"center",alignItems:"center",style:{display:"flex"}},o.a.createElement(ke.a,{style:{fontSize:"1.3em"}})))))),"available"===e.section&&e.currentUser.personalMeetingUrl&&!e.isCurrentUser&&o.a.createElement(d.a,{item:!0},o.a.createElement(le.a,{"aria-label":"start video call",onClick:function(){var t=e.currentUser.personalMeetingUrl;A(e.user.userId,e.currentUser.userId,t),window.open(t,"_blank")}},o.a.createElement(we.a,{color:i?"secondary":"error"}))),!e.currentUser.personalMeetingUrl&&e.isCurrentUser&&"available"===e.section&&o.a.createElement(d.a,{item:!0},o.a.createElement(Q.a,{variant:"contained",color:"secondary",onClick:function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:window.open("https://zoom.us/profile","_blank");case 1:case"end":return e.stop()}}))}},"Acquire Meeting Url")),e.isCurrentUser&&"appHeader"===e.section&&o.a.createElement(d.a,{item:!0},o.a.createElement(pe.a,{variant:"text",size:"small","aria-label":"small outlined button group"},!i&&o.a.createElement(le.a,{onClick:function(){Y.updateUserDoNotDistrubUntil(e.mainGroupStore.state.appGroup.appGroupId,e.user.userId,Date.now()-1)},size:"small",color:"primary"},o.a.createElement(ge.a,null)),!i&&o.a.createElement(le.a,{onClick:function(){Y.updateUserDoNotDistrubUntil(e.mainGroupStore.state.appGroup.appGroupId,e.user.userId,e.user.doNotDisturbUntil-9e5)},size:"small",color:"primary"},o.a.createElement(Oe.a,null)),o.a.createElement(Q.a,{onClick:function(){var t=i?Date.now():e.user.doNotDisturbUntil,a=i?36e5:9e5;Y.updateUserDoNotDistrubUntil(e.mainGroupStore.state.appGroup.appGroupId,e.user.userId,t+a)},variant:"outlined",style:i?{}:{color:he.error.main}},!i&&o.a.createElement(Se.a,null),"Busy"))))};function Ne(e,t){if(null===t)return"Calendar not synced";if(e>Date.now())return"Busy for ~"+me(e-Date.now()+6e4);var a=new Date,r=a.getTime(),n=a.toDateString(),c=t.filter((function(e){var t=new Date(e.endTime).getTime()>r,a=new Date(e.startTime).toDateString();return t&&a===n}))[0];if(c){var o=new Date(c.startTime),u=new Date(c.endTime),i=o.getTime()<r,s=de(o),l=de(u);return i?"".concat(c.eventName," ends at ").concat(l):"Next meeting at ".concat(s)}return"No upcoming events"}var De=a(76),_e=function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";var a=document.getSelection(),r=null;a&&a.rangeCount>0&&(r=a.getRangeAt(0)),document.body.appendChild(t),t.select(),t.selectionStart=0,t.selectionEnd=e.length;var n=!1;try{n=document.execCommand("copy")}catch(c){}return document.body.removeChild(t),a&&r&&(a.removeAllRanges(),a.addRange(r)),n},Ce=a(58),Pe=a.n(Ce),Re=a(78),Me=a.n(Re),Fe=Object(De.a)((function(e){return{icon:{transform:"rotate(135deg)"}}})),Le=function(e){var t=Fe(),a=Object(c.useState)(!1),r=Object(f.a)(a,2),n=r[0],u=r[1],i=Object(c.useState)(!1),s=Object(f.a)(i,2),p=s[0],m=s[1];return o.a.createElement(d.a,{container:!0,direction:"column",spacing:2,justify:"center"},o.a.createElement(d.a,{item:!0},o.a.createElement(d.a,{container:!0,direction:"row",spacing:3,justify:"center",alignItems:"center"},o.a.createElement(d.a,{item:!0},o.a.createElement(Q.a,{variant:"outlined",color:"secondary",onClick:function(){var t=window.location.origin+window.location.pathname+"?joinId="+e.mainGroupStore.state.appGroup.appGroupId;_e(t),u(!0),setTimeout((function(){u(!1)}),2e3)}},n?o.a.createElement(Pe.a,null):o.a.createElement(se.a,{className:t.icon}),e.mainGroupStore.state.appGroup.appGroupId)),o.a.createElement(d.a,{item:!0},o.a.createElement(Q.a,{variant:"contained",color:"primary",onClick:function(){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.awrap(oe(e.user.userId,e.mainGroupStore.state.appGroup.appGroupId));case 2:m(!0),setTimeout((function(){m(!1)}),2e3);case 4:case"end":return t.stop()}}))}},p?o.a.createElement(Pe.a,null):o.a.createElement(Me.a,null),"Sync Google Calendar")))),o.a.createElement(d.a,{item:!0},o.a.createElement(je,{user:e.user,mainGroupStore:e.mainGroupStore,isCurrentUser:!0,currentUser:e.user,showNextMeetingTime:!0,section:"appHeader",darkTheme:e.darkTheme})),o.a.createElement(d.a,{item:!0},o.a.createElement(W.a,null)))},Je=a(163),ze=a(157),Be=a(158),He=function(e){var t=Object(c.useState)(!1),a=Object(f.a)(t,2),r=a[0],n=a[1];return o.a.createElement(d.a,{container:!0,direction:"row",spacing:1,alignItems:"center"},o.a.createElement(d.a,{item:!0},o.a.createElement(Je.a,{checked:r,onChange:function(e){n(e.target.checked)},color:"default",value:"primary",inputProps:{"aria-label":"leave group confirmation"}})),o.a.createElement(d.a,{item:!0,style:{flexGrow:1}},o.a.createElement(Q.a,{variant:"contained",color:"secondary",size:"small",disabled:!r,onClick:function(){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e.appStore.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),t.next=3,l.a.awrap(ee(e.user,e.mainGroupStore.state.appGroup));case 3:e.appStore.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"joinGroup",user:Object(w.a)({},e.user,{groupId:null})}});case 4:case"end":return t.stop()}}))}},"Leave Group")),o.a.createElement(d.a,{item:!0},o.a.createElement(ze.a,{control:o.a.createElement(Be.a,{checked:e.darkThemeState[0],onChange:function(t){e.darkThemeState[1](t.target.checked),F("darkTheme",t.target.checked)}}),label:o.a.createElement(p.a,{variant:"caption"},"Dark Theme")})))},Ke=a(79),Qe=a.n(Ke),We=function(e){var t=e.mainGroupStore,a=e.currentUserId;return o.a.createElement(d.a,{container:!0,direction:"column"},o.a.createElement(p.a,null,o.a.createElement("b",null,"Zoom Calls")),Z.a.values(e.videoMeetings).map((function(r){var n=me(Date.now()-new Date(r.meeting.meetingStartTime).getTime());return o.a.createElement(d.a,{container:!0,direction:"row",spacing:2,justify:"flex-start",alignItems:"center"},o.a.createElement(d.a,{item:!0},o.a.createElement(d.a,{container:!0,direction:"row",spacing:2,justify:"flex-start",alignItems:"center"},o.a.createElement(d.a,{item:!0},o.a.createElement(Q.a,{variant:"text",color:"primary",href:r.meeting.meetingUrl,target:"_blank"},"Join Meeting ",o.a.createElement(we.a,null))),o.a.createElement(d.a,{item:!0},o.a.createElement(p.a,{style:{display:"flex"}},o.a.createElement(Qe.a,null),n))),Z.a.values(r.users).map((function(r){return o.a.createElement(je,{mainGroupStore:t,user:r,isCurrentUser:r.userId===a,currentUser:t.state.appGroup.userIds[a],section:"video",showNextMeetingTime:r.userId!==a,darkTheme:e.darkTheme})}))))})))},Ve=function(e){var t=e.mainGroupStore,a=e.currentUserId;return o.a.createElement(d.a,{container:!0,direction:"column"},o.a.createElement(p.a,null,o.a.createElement("b",null,"Google Calendar Events")),Z.a.values(e.calendarMeetings).map((function(r){var n=Z.a.values(r.users).filter((function(e){return!!e.currentMeeting}))[0],c=n&&n.currentMeeting?n.currentMeeting.meetingUrl:null;return o.a.createElement(d.a,{container:!0,direction:"row",spacing:2,justify:"flex-start",alignItems:"center"},o.a.createElement(d.a,{item:!0,style:{flexGrow:1}},o.a.createElement(d.a,{container:!0,direction:"row",justify:"flex-start",spacing:1,alignItems:"center"},o.a.createElement(d.a,{item:!0,style:{flexGrow:1,paddingLeft:"1em"}},o.a.createElement(p.a,{variant:"subtitle2"},r.meeting.eventName)),o.a.createElement(d.a,{item:!0},o.a.createElement(p.a,{variant:"subtitle2"},de(new Date(r.meeting.startTime))+" - "+de(new Date(r.meeting.endTime))))),Z.a.values(r.users).map((function(r){return o.a.createElement(je,{mainGroupStore:t,user:r,isCurrentUser:r.userId===a,currentUser:t.state.appGroup.userIds[a],section:"calendar",showNextMeetingTime:!1,darkTheme:e.darkTheme})}))),c&&o.a.createElement(d.a,{item:!0},o.a.createElement(le.a,{color:"primary","aria-label":"join calendar meeting video call",href:c,target:"_blank"},o.a.createElement(we.a,null))))})))},Ye=a(83);function qe(e){if(e){var t=Date.now();return e.filter((function(e){var a=new Date(e.endTime).getTime()>t,r=new Date(e.startTime).getTime();return a&&r<t}))[0]}return null}var Ze=function(e){var t=e.mainGroupStore,a=e.user.userId,r=function(e,t){var a=e.userIds,r=a[t],n=Object(P.a)(a,[t].map(R.a)),c=[r].concat(Object(Ye.a)(Z.a.values(n).sort())),o=Date.now(),u=c.reduce((function(e,t){return o-t.lastOnline>1.5*Xe?Object(w.a)({},e,Object(v.a)({},t.userId,t)):e}),{}),i=c.reduce((function(e,t){if(!u[t.userId]&&t.currentMeeting){var a=t.currentMeeting,r=e[a.meetingId],n=r?r.users:{};return Object(w.a)({},e,Object(v.a)({},a.meetingId,{meeting:a,users:Object(w.a)({},n,Object(v.a)({},t.userId,t))}))}return e}),{}),s=c.reduce((function(e,t){var a=!u[t.userId],r=qe(t.dailyCalendarEvents);if(a&&r){var n=e[r.id],c=n?n.users:{};return Object(w.a)({},e,Object(v.a)({},r.id,{meeting:r,users:Object(w.a)({},c,Object(v.a)({},t.userId,t))}))}return e}),{}),l=c.reduce((function(e,t){var a=!u[t.userId],r=!t.currentMeeting,n=!qe(t.dailyCalendarEvents),c=t.doNotDisturbUntil<Date.now();return a&&r&&n&&c?Object(w.a)({},e,Object(v.a)({},t.userId,t)):e}),{}),p=c.reduce((function(e,t){var a=!u[t.userId],r=!t.currentMeeting,n=!qe(t.dailyCalendarEvents),c=t.doNotDisturbUntil>Date.now();return a&&r&&n&&c?Object(w.a)({},e,Object(v.a)({},t.userId,t)):e}),{});return{offline:u,video:i,calendar:s,available:l,doNotDisturb:p}}(t.state.appGroup,a);return o.a.createElement(d.a,{container:!0,direction:"column",spacing:2,justify:"center"},o.a.createElement(d.a,{item:!0},o.a.createElement(p.a,null,o.a.createElement("b",null,"Available")),Z.a.values(r.available).map((function(r){return o.a.createElement(je,{mainGroupStore:t,user:r,isCurrentUser:r.userId===a,currentUser:t.state.appGroup.userIds[a],section:"available",showNextMeetingTime:r.userId!==a,darkTheme:e.darkTheme})}))),o.a.createElement(d.a,{item:!0},o.a.createElement(We,{mainGroupStore:t,currentUserId:a,videoMeetings:r.video,darkTheme:e.darkTheme})),o.a.createElement(d.a,{item:!0},o.a.createElement(Ve,{mainGroupStore:t,currentUserId:a,calendarMeetings:r.calendar,darkTheme:e.darkTheme})),o.a.createElement(d.a,{item:!0},o.a.createElement(p.a,null,o.a.createElement("b",null,"Do Not Disturb")),Z.a.values(r.doNotDisturb).map((function(r){return o.a.createElement(je,{mainGroupStore:t,user:r,isCurrentUser:r.userId===a,currentUser:t.state.appGroup.userIds[a],section:"doNotDisturb",showNextMeetingTime:!0,darkTheme:e.darkTheme})}))),o.a.createElement(d.a,{item:!0},o.a.createElement(p.a,null,o.a.createElement("b",null,"Offline")),Z.a.values(r.offline).map((function(r){return o.a.createElement(je,{mainGroupStore:t,user:r,isCurrentUser:r.userId===a,currentUser:t.state.appGroup.userIds[a],section:"offline",showNextMeetingTime:!1,darkTheme:e.darkTheme})}))),o.a.createElement(d.a,{item:!0},o.a.createElement(W.a,null)))},Xe=2e4,$e=function(e){var t=Object(c.useContext)(D),a=function(e){var t=Object(c.useReducer)(ae,{appGroup:e,lastCheckForMeetingUIUpdate:0}),a=Object(f.a)(t,2);return{state:a[0],dispatch:a[1]}}(e.appState.initialAppGroup);return o.a.useEffect((function(){oe(e.appState.user.userId,a.state.appGroup.appGroupId);var t=setInterval((function(){oe(e.appState.user.userId,a.state.appGroup.appGroupId)}),6e5);Y.sendAlivePing(e.appState.user.userId,a.state.appGroup.appGroupId);var r,n,c=setInterval((function(){Y.sendAlivePing(e.appState.user.userId,a.state.appGroup.appGroupId)}),Xe),o=(r=a.state.appGroup.appGroupId,n=a.dispatch,Y.watchAppGroup(r,(function(e){n({type:"UPDATE_APP_GROUP",newAppGroup:e})}))),u=setInterval((function(){a.dispatch({type:"CHECK_FOR_MEETINGS_UI_UPDATE"})}),1e4);return function(){clearInterval(t),clearInterval(c),o(),clearInterval(u)}}),[]),o.a.createElement(d.a,{container:!0,direction:"column",justify:"center",alignItems:"flex-start",spacing:2},e.appState.popupsBlocked&&o.a.createElement(d.a,{item:!0,style:{width:"100%"}},o.a.createElement(p.a,{color:"error"},'Please "Always allow popups" in order to receive video calls.')),o.a.createElement(d.a,{item:!0,style:{width:"100%"}},o.a.createElement(Le,{mainGroupStore:a,user:a.state.appGroup.userIds[e.appState.user.userId],darkTheme:e.darkThemeState[0]})),o.a.createElement(d.a,{item:!0,style:{width:"100%"}},o.a.createElement(Ze,{mainGroupStore:a,user:a.state.appGroup.userIds[e.appState.user.userId],darkTheme:e.darkThemeState[0]})),o.a.createElement(d.a,{item:!0,style:{width:"100%"}},o.a.createElement(He,{appStore:t,mainGroupStore:a,user:e.appState.user,darkThemeState:e.darkThemeState})))},et=function(){switch(window.location.host){case"localhost:3006":return{CLOUD_FUNCTION_ENDPOINT:"http://localhost:8080"};case"pearcoco.com":return{CLOUD_FUNCTION_ENDPOINT:"https://us-central1-project-coco-production.cloudfunctions.net"};default:throw new Error("unknown window host:".concat(window.location.host))}},tt=new Promise((function(e,t){z("logged_in")?(window.history.pushState({},document.title,B("logged_in")),e()):window.location.href="".concat(et().CLOUD_FUNCTION_ENDPOINT,"/zoomGetTokenData?redirectUrl=").concat(window.location.href)})),at=function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.awrap(tt);case 2:case"end":return e.stop()}}))};function rt(){var e,t;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(at());case 2:return a.next=4,l.a.awrap(fetch(et().CLOUD_FUNCTION_ENDPOINT+"/loginUser",{credentials:"include"}));case 4:return e=a.sent,a.next=7,l.a.awrap(e.json());case 7:return t=a.sent,a.abrupt("return",t);case 9:case"end":return a.stop()}}))}var nt=a(159);function ct(e,t){return S.watchUser(e,(function(e){t({type:"UPDATE_USER",newUser:e})}))}var ot=a(27),ut=a(80);var it=function(e){return o.a.createElement(nt.a,{maxWidth:"xs",style:{marginTop:"2em"}},o.a.createElement(ut.a,null,o.a.createElement("div",null,o.a.createElement(ot.a,{path:"/",render:function(){return o.a.createElement(st,{darkThemeState:e.darkThemeState})}}))))},st=function(e){var t=function(){var e=Object(c.useReducer)(j,k),t=Object(f.a)(e,2);return{state:t[0],dispatch:t[1]}}();switch(t.state.view){case"initial":return function(e){var t,a,r,n;l.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,l.a.awrap(rt());case 2:return t=c.sent,o=t.config,h=o,c.next=6,l.a.awrap(b(t.customToken));case 6:return c.next=8,l.a.awrap(S.findOrCreateUser(t.user));case 8:if(!(a=c.sent).groupId){c.next=15;break}return c.next=12,l.a.awrap(Y.getAppGroup(a.groupId));case 12:c.t0=c.sent,c.next=18;break;case 15:return c.next=17,l.a.awrap(lt(a));case 17:c.t0=c.sent;case 18:if(r=c.t0,ct(a.userId,e.dispatch),!r){c.next=28;break}return Y.updateUser(a,r.appGroupId),c.next=24,l.a.awrap(S.findOrCreateUser(t.user));case 24:n=c.sent,e.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:n,initialAppGroup:r,popupsBlocked:H()}}),c.next=29;break;case 28:e.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"joinGroup",user:a}});case 29:case"end":return c.stop()}var o}))}(t),o.a.createElement(m,null);case"loading":return o.a.createElement(m,null);case"joinGroup":return o.a.createElement(D.Provider,{value:t},o.a.createElement(te,{appState:t.state}));case"mainGroup":return o.a.createElement(D.Provider,{value:t},o.a.createElement($e,{appState:t.state,darkThemeState:e.darkThemeState}));default:t.state;throw new Error("unknown state view")}};function lt(e){var t,a;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(t=z("joinId"))){r.next=9;break}return r.next=4,l.a.awrap($(e,t));case 4:return a=r.sent,window.history.pushState({},document.title,B("joinId")),r.abrupt("return",a);case 9:return r.abrupt("return",null);case 10:case"end":return r.stop()}}))}var pt=M("darkTheme")||!1;i.a.render(o.a.createElement((function(){var e,t=Object(c.useState)(pt),a=t[0]?"dark":"light";return o.a.createElement(n.a,{theme:(e=a,Object(Ie.a)({palette:Object(w.a)({type:e},he,{background:{default:"light"===e?xe:be}})}))},o.a.createElement(r.a,null),o.a.createElement(it,{darkThemeState:t}))}),null),document.getElementById("root"))},92:function(e,t,a){e.exports=a(117)}},[[92,1,2]]]);
//# sourceMappingURL=main.4641a7c8.chunk.js.map