(this["webpackJsonpdemo-react"]=this["webpackJsonpdemo-react"]||[]).push([[0],{108:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(14),o=a.n(c),u=a(3),i=a.n(u),s=a(145),p=a(141),l=function(){return r.a.createElement(p.a,{container:!0,direction:"column",justify:"center",alignItems:"center",spacing:5},r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,null,"Loading")))},d=a(25),m=a(10),f=a(11),v=a(30),w=a.n(v);a(101);function g(){if(I)return I;throw new Error("config not initialized")}var I=null;function E(){if(h)return h;throw new Error("firestoreDb not initialized")}function x(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return w.a.initializeApp({apiKey:g().FIRESTORE_API_KEY,authDomain:g().FIRESTORE_AUTH_DOMAIN,projectId:g().FIRESTORE_PROJECT_ID}),t.next=3,i.a.awrap(w.a.auth().signInWithCustomToken(e).catch((function(e){var t=e.code,a=e.message;throw console.log("firestoreInitialize error",t,a),e})));case 3:h=w.a.firestore();case 4:case"end":return t.stop()}}))}var h=null,y=function(e){return{get:function(t){var a,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a=E().collection(e).doc(t),r.next=3,i.a.awrap(a.get());case 3:if(!(n=r.sent).exists){r.next=8;break}return r.abrupt("return",n.data());case 8:return r.abrupt("return",null);case 9:case"end":return r.stop()}}))},set:function(t,a){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(E().collection(e).doc(t).set(a));case 2:case"end":return n.stop()}}))},update:function(t,a){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(E().collection(e).doc(t).update(a));case 2:case"end":return n.stop()}}))},delete:function(t){return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(E().collection(e).doc(t).delete());case 2:case"end":return a.stop()}}))},watch:function(t,a){return E().collection(e).doc(t).onSnapshot((function(e){a(e.data())}))},batch:function(){return E().batch()},docRef:function(t){return E().collection(e).doc(t)},collectionRef:function(t){return E().collection(e)}}},b=y("users"),G={watchUser:function(e,t){return b.watch(e,t)},getUser:function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.awrap(b.get(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},createUser:function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.awrap(b.set(e.userId,e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},findOrCreateUser:function(e){var t,a,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.awrap(G.getUser(e.id));case 2:if(!(t=r.sent)){r.next=10;break}return a=Object(m.a)({},t,{displayName:e.first_name+" "+e.last_name,personalMeetingUrl:e.personal_meeting_url,avatarUrl:e.pic_url}),r.next=7,i.a.awrap(b.update(a.userId,a));case 7:return r.abrupt("return",a);case 10:return n={userId:e.id,groupId:null,displayName:e.first_name+" "+e.last_name,personalMeetingUrl:e.personal_meeting_url,avatarUrl:e.pic_url,notificationQueue:{}},r.next=13,i.a.awrap(b.set(n.userId,n));case 13:return r.abrupt("return",n);case 14:case"end":return r.stop()}}))},updateGroup:function(e,t){return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(b.update(e,{groupId:t}));case 2:case"end":return a.stop()}}))},pushNotification:function(e,t){var a;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return a=Object(f.a)({},"notificationQueue.".concat(t.notificationId),t),n.next=3,i.a.awrap(b.update(e,a));case 3:case"end":return n.stop()}}))},clearNotifications:function(e,t){var a;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return a=b.batch(),t.map((function(t){var n=b.docRef(e);a.update(n,Object(f.a)({},"notificationQueue.".concat(t.notificationId),w.a.firestore.FieldValue.delete()))})),n.next=4,i.a.awrap(a.commit());case 4:case"end":return n.stop()}}))}};function S(e,t){for(var a="",n=0;n<e;n++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}var O=function(e,t){var a=Object.values(e);a.length>0&&(a.map((function(e){switch(e.type){case"openMeeting":window.open(e.meetingUrl,"_blank");break;default:console.log("unknown notification.type: ",e.type);e.type}})),G.clearNotifications(t,a))},T=function(e,t,a){return G.pushNotification(e,{type:"openMeeting",meetingUrl:a,from:"user",fromId:t,timestamp:Date.now(),notificationId:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))})},A={view:"initial"};function U(e,t){switch(console.log("appStoreReducer previous state:",e),console.log("appStoreReducer",t),t.type){case"TRANSITION_APP_STATE":return j(t.newAppState,e);case"UPDATE_USER":switch(e.view){case"joinGroup":case"mainGroup":return j(Object(m.a)({},e,{user:t.newUser}),e);case"initial":case"loading":return e;default:return e}default:return e}}function j(e,t){return console.log("appStoreReducer computed state",e),function(e,t){switch(e.view){case"joinGroup":case"mainGroup":O(e.user.notificationQueue,e.user.userId);break;case"initial":case"loading":break;default:}}(e),e}var _=r.a.createContext(null);var N={joinId:""};function C(e,t){switch(console.log("joinGroupStoreReducer previous state:",e),console.log("joinGroupStoreReducer",t),t.type){case"UPDATE_JOIN_ID":return a=Object(m.a)({},e,{joinId:t.newJoinId}),console.log("joinGroupStoreReducer computed state",a),a;default:t.type;return e}var a}r.a.createContext(null);var k=a(54),P=a(52),D=function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null},R=function(e,t){localStorage.setItem(e,JSON.stringify(t))},M=a(38),F=a.n(M),L=function(e){var t=F.a.parse(window.location.search.slice(1)),a=t?t[e]:null;return a instanceof Array?a[0]:a},J=function(e){var t=F.a.parse(window.location.search.slice(1)),a=(t[e],Object(k.a)(t,[e].map(P.a))),n=Object.keys(a).length>0?"?"+F.a.stringify(a):"";return window.location.origin+window.location.pathname+n},z=function(){if(D("popupsArentBlocked"))return!1;var e=window.open("","_blank");try{return!e||(e.close(),R("popupsArentBlocked",!0),!1)}catch(t){return!0}},B=a(152),K=a(146),H=a(147),Q=y("appGroups"),V={watchAppGroup:function(e,t){return Q.watch(e,t)},getAppGroup:function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.awrap(Q.get(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},getExistingAppGroup:function(e){var t;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(Q.get(e));case 2:if(!(t=a.sent)){a.next=7;break}return a.abrupt("return",t);case 7:throw new Error("getExistingAppGroup: group doesn't exist with id:"+e);case 8:case"end":return a.stop()}}))},deleteAppGroup:function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.awrap(Q.delete(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},createAppGroup:function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.awrap(Q.set(e.appGroupId,e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}))},createNewAppGroup:function(e){var t;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t={appGroupId:"G"+(n=5,S(n,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")).toUpperCase(),userIds:Object(f.a)({},e.userId,Object(m.a)({},e,{userId:e.userId,lastOnline:Date.now(),availabilityStatus:"available",currentMeeting:null,dailyCalendarEvents:null}))},a.next=3,i.a.awrap(Q.set(t.appGroupId,t));case 3:return a.abrupt("return",t);case 4:case"end":return a.stop()}var n}))},userJoinExistingAppGroup:function(e,t){var a,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a=Object(m.a)({},e,{userId:e.userId,lastOnline:Date.now(),availabilityStatus:"available",currentMeeting:null,dailyCalendarEvents:null}),n=Object(f.a)({},"userIds.".concat(e.userId),a),Q.update(t,n),r.abrupt("return",V.getExistingAppGroup(t));case 4:case"end":return r.stop()}}))},removeUserFromAppGroup:function(e,t){return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(Q.update(e.appGroupId,Object(f.a)({},"userIds.".concat(t.userId),w.a.firestore.FieldValue.delete())));case 2:case"end":return a.stop()}}))},setUserCalendarEvents:function(e,t,a){var n=Object(f.a)({},"userIds.".concat(e,".dailyCalendarEvents"),a);Q.update(t,n)},updateUser:function(e,t){var a,n=(a={},Object(f.a)(a,"userIds.".concat(e.userId,".avatarUrl"),e.avatarUrl),Object(f.a)(a,"userIds.".concat(e.userId,".displayName"),e.displayName),Object(f.a)(a,"userIds.".concat(e.userId,".groupId"),e.groupId),Object(f.a)(a,"userIds.".concat(e.userId,".personalMeetingUrl"),e.personalMeetingUrl),a);Q.update(t,n)},sendAlivePing:function(e,t){var a=Object(f.a)({},"userIds.".concat(e,".lastOnline"),Date.now());Q.update(t,a)}},W=a(19),Y=a.n(W),q=function(e){var t;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(V.createNewAppGroup(e));case 2:return t=a.sent,a.next=5,i.a.awrap(G.updateGroup(e.userId,t.appGroupId));case 5:return a.abrupt("return",t);case 6:case"end":return a.stop()}}))},Z=function(e,t){var a;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(V.getAppGroup(t));case 2:if(!n.sent){n.next=12;break}return n.next=6,i.a.awrap(V.userJoinExistingAppGroup(e,t));case 6:return a=n.sent,n.next=9,i.a.awrap(G.updateGroup(e.userId,t));case 9:return n.abrupt("return",a);case 12:return n.abrupt("return",null);case 13:case"end":return n.stop()}}))},X=function(e,t){var a;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(G.updateGroup(e.userId,null));case 2:return n.next=4,i.a.awrap(V.removeUserFromAppGroup(t,e));case 4:return n.next=6,i.a.awrap(V.getAppGroup(t.appGroupId));case 6:if(!(a=n.sent)||!a.userIds||0!==Y.a.values(a.userIds).length){n.next=10;break}return n.next=10,i.a.awrap(V.deleteAppGroup(a.appGroupId));case 10:case"end":return n.stop()}}))},$=function(e){var t=Object(n.useContext)(_),a=function(){var e=Object(n.useReducer)(C,N),t=Object(d.a)(e,2);return{state:t[0],dispatch:t[1]}}();return r.a.createElement(p.a,{container:!0,direction:"column",justify:"center",alignItems:"center",spacing:5},r.a.createElement(p.a,{item:!0},r.a.createElement(p.a,{container:!0,direction:"row",justify:"center",alignItems:"center",spacing:2},r.a.createElement(p.a,{item:!0},r.a.createElement(B.a,{label:"Group Id",margin:"normal",variant:"outlined",value:a.state.joinId,onChange:function(e){a.dispatch({type:"UPDATE_JOIN_ID",newJoinId:e.target.value.toUpperCase()})}})),r.a.createElement(p.a,{item:!0},r.a.createElement(K.a,{color:"primary",variant:"contained",onClick:function(){var n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),r.next=3,i.a.awrap(Z(e.appState.user,a.state.joinId));case 3:(n=r.sent)?t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:Object(m.a)({},e.appState.user,{groupId:n.appGroupId}),initialAppGroup:n,popupsBlocked:z()}}):(t.dispatch({type:"TRANSITION_APP_STATE",newAppState:e.appState}),console.log("group doesn't exist"));case 5:case"end":return r.stop()}}))}},"Join")))),r.a.createElement(H.a,{variant:"middle"}),r.a.createElement(p.a,{item:!0},r.a.createElement(K.a,{color:"secondary",variant:"contained",onClick:function(){var a;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),n.next=3,i.a.awrap(q(e.appState.user));case 3:a=n.sent,t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:Object(m.a)({},e.appState.user,{groupId:a.appGroupId}),initialAppGroup:a,popupsBlocked:z()}});case 5:case"end":return n.stop()}}))}},"Create Group")))};function ee(e,t){switch(console.log("mainGroupStoreReducer previous state:",e),console.log("mainGroupStoreReducer",t),t.type){case"UPDATE_APP_GROUP":return te(Object(m.a)({},e,{appGroup:t.newAppGroup}));case"CHECK_FOR_MEETINGS_UI_UPDATE":return te(Object(m.a)({},e,{lastCheckForMeetingUIUpdate:Date.now()}));default:return e}}function te(e){return console.log("mainGroupStoreReducer computed state",e),e}r.a.createContext(null);var ae=null;var ne=function(){var e,t,a,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.awrap(i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ae){e.next=6;break}return e.next=3,i.a.awrap(ae);case 3:return e.abrupt("return",gapi.client);case 6:return ae=i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(new Promise((function(e,t){gapi.load("client:auth2",{callback:function(){var a,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,a={apiKey:g().GOOGLE_CALENDAR_API_KEY,clientId:g().GOOGLE_AUTH_CLIENT_ID,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],scope:"https://www.googleapis.com/auth/calendar.events.readonly"},r.next=4,i.a.awrap(gapi.client.init(a));case 4:if((n=gapi.auth2.getAuthInstance()).isSignedIn.get()){r.next=9;break}return r.next=9,i.a.awrap(n.signIn());case 9:e(),r.next=16;break;case 12:r.prev=12,r.t0=r.catch(0),ae=null,t(r.t0);case 16:case"end":return r.stop()}}),null,null,[[0,12]])}})})));case 2:case"end":return e.stop()}})),e.next=9,i.a.awrap(ae);case 9:return e.abrupt("return",gapi.client);case 10:case"end":return e.stop()}})));case 2:return e=r.sent,r.next=5,i.a.awrap(e.calendar.events.list({calendarId:"primary",timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"}));case 5:return t=r.sent,a=t.result,n=a.items||[],console.log("Upcoming events:",n),n.map((function(e){var t=e.start?e.start.dateTime||e.start.date:null;console.log(e.summary+" ("+t+")")})),r.abrupt("return",n);case 11:case"end":return r.stop()}}))},re=function(e,t){var a,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.awrap(ne());case 2:a=r.sent,n=a.map(ce),V.setUserCalendarEvents(e,t,n);case 5:case"end":return r.stop()}}))};function ce(e){var t=e.id,a=e.summary,n=e.start?e.start.dateTime||e.start.date:null,r=e.end?e.end.dateTime||e.end.date:null,c=e.htmlLink;if(t&&a&&n&&r&&c)return{id:t,eventName:a,startTime:n,endTime:r,eventLink:c};throw console.log("gapi calendar event",e),new Error("gapi calendar event is missing properties")}var oe=a(70),ue=a.n(oe),ie=a(154),se=function(e){return e.toLocaleTimeString().slice(0,-6)+e.toLocaleTimeString().slice(-2)},pe=function(e){var t=Math.floor(e/6e4),a=t%60,n=Math.floor(t/60);return(n>0?"".concat(n,":"):"")+(a<10?"0"+a:a)},le=function(e){var t=e.mainGroupStore.state.appGroup.userIds[e.user.userId].dailyCalendarEvents,a=Object(n.useState)(de(t)),c=Object(d.a)(a,2),o=c[0],u=c[1];return r.a.useEffect((function(){u(de(t));var e=setInterval((function(){u(de(t))}),1e4);return function(){clearInterval(e)}}),[e.mainGroupStore.state.appGroup.userIds[e.user.userId].dailyCalendarEvents]),console.log(e.currentUser.personalMeetingUrl),r.a.createElement(p.a,{container:!0,direction:"row",spacing:2,justify:"flex-start",alignItems:"center"},r.a.createElement(p.a,{item:!0},r.a.createElement(ie.a,{alt:e.user.displayName,src:e.user.avatarUrl})),r.a.createElement(p.a,{item:!0},r.a.createElement(p.a,{container:!0,direction:"column",spacing:0,justify:"flex-start"},r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,null,e.user.displayName)),e.showNextMeetingTime&&r.a.createElement(p.a,{item:!0},e.isCurrentUser&&"Calendar not synced"===o?r.a.createElement(s.a,{variant:"caption",color:"error"},r.a.createElement("i",null,o)):r.a.createElement(s.a,{variant:"caption"},r.a.createElement("i",null,o))))),"available"===e.section&&e.currentUser.personalMeetingUrl&&!e.isCurrentUser&&r.a.createElement(p.a,{item:!0},r.a.createElement(K.a,{variant:"contained",color:"secondary",onClick:function(){var t;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:t=e.currentUser.personalMeetingUrl,T(e.user.userId,e.currentUser.userId,t),window.open(t,"_blank");case 3:case"end":return a.stop()}}))}},"Call")),!e.currentUser.personalMeetingUrl&&e.isCurrentUser&&"available"===e.section&&r.a.createElement(p.a,{item:!0},r.a.createElement(K.a,{variant:"contained",color:"secondary",onClick:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:window.open("https://zoom.us/profile","_blank");case 1:case"end":return e.stop()}}))}},"Acquire Meeting Url")))};function de(e){if(null===e)return"Calendar not synced";var t=new Date,a=t.getTime(),n=t.toDateString(),r=e.filter((function(e){var t=new Date(e.endTime).getTime()>a,r=new Date(e.startTime).toDateString();return t&&r===n}))[0];if(r){var c=new Date(r.startTime),o=new Date(r.endTime),u=c.getTime()<a,i=se(c),s=se(o);return u?"".concat(r.eventName," ends at ").concat(s):"Next meeting at ".concat(i)}return"No upcoming events"}var me=a(69),fe=function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";var a=document.getSelection(),n=null;a&&a.rangeCount>0&&(n=a.getRangeAt(0)),document.body.appendChild(t),t.select(),t.selectionStart=0,t.selectionEnd=e.length;var r=!1;try{r=document.execCommand("copy")}catch(c){}return document.body.removeChild(t),a&&n&&(a.removeAllRanges(),a.addRange(n)),r},ve=Object(me.a)((function(e){return{icon:{transform:"rotate(135deg)"}}})),we=function(e){var t=ve();return r.a.createElement(p.a,{container:!0,direction:"column",spacing:2,justify:"center"},r.a.createElement(p.a,{item:!0},r.a.createElement(p.a,{container:!0,direction:"row",spacing:3,justify:"center",alignItems:"center"},r.a.createElement(p.a,{item:!0},r.a.createElement(K.a,{variant:"outlined",color:"secondary",onClick:function(){var t=window.location.origin+window.location.pathname+"?joinId="+e.mainGroupStore.state.appGroup.appGroupId;fe(t)}},e.mainGroupStore.state.appGroup.appGroupId,r.a.createElement(ue.a,{className:t.icon}))),r.a.createElement(p.a,{item:!0},r.a.createElement(K.a,{variant:"contained",color:"primary",onClick:function(){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:re(e.user.userId,e.mainGroupStore.state.appGroup.appGroupId);case 1:case"end":return t.stop()}}))}},"Sync Google Calendar")))),r.a.createElement(p.a,{item:!0},r.a.createElement(le,{user:e.user,mainGroupStore:e.mainGroupStore,isCurrentUser:!0,currentUser:e.user,showNextMeetingTime:!0,section:"appHeader"})),r.a.createElement(p.a,{item:!0},r.a.createElement(H.a,null)))},ge=a(153),Ie=function(e){var t=Object(n.useState)(!1),a=Object(d.a)(t,2),c=a[0],o=a[1];return r.a.createElement(p.a,{container:!0,direction:"row",spacing:1,alignItems:"center"},r.a.createElement(p.a,{item:!0},r.a.createElement(ge.a,{checked:c,onChange:function(e){o(e.target.checked)},color:"default",value:"primary",inputProps:{"aria-label":"leave group confirmation"}})),r.a.createElement(p.a,{item:!0},r.a.createElement(K.a,{variant:"contained",color:"secondary",size:"small",disabled:!c,onClick:function(){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e.appStore.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),t.next=3,i.a.awrap(X(e.user,e.mainGroupStore.state.appGroup));case 3:e.appStore.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"joinGroup",user:Object(m.a)({},e.user,{groupId:null})}});case 4:case"end":return t.stop()}}))}},"Leave Group")))},Ee=a(51),xe=a.n(Ee),he=a(71),ye=a.n(he),be=function(e){var t=e.mainGroupStore,a=e.currentUserId;return r.a.createElement(p.a,{container:!0,direction:"column"},r.a.createElement(s.a,null,r.a.createElement("b",null,"Zoom Calls")),Y.a.values(e.videoMeetings).map((function(e){var n=pe(Date.now()-new Date(e.meeting.meetingStartTime).getTime());return r.a.createElement(p.a,{container:!0,direction:"row",spacing:2,justify:"flex-start",alignItems:"center"},r.a.createElement(p.a,{item:!0},r.a.createElement(p.a,{container:!0,direction:"row",spacing:2,justify:"flex-start",alignItems:"center"},r.a.createElement(p.a,{item:!0},r.a.createElement(K.a,{variant:"text",color:"primary",href:e.meeting.meetingUrl,target:"_blank"},"Join Meeting ",r.a.createElement(xe.a,null))),r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{style:{display:"flex"}},n,r.a.createElement(ye.a,null)))),Y.a.values(e.users).map((function(e){return r.a.createElement(le,{mainGroupStore:t,user:e,isCurrentUser:e.userId===a,currentUser:t.state.appGroup.userIds[a],section:"video",showNextMeetingTime:e.userId!==a})}))))})))},Ge=a(148),Se=function(e){var t=e.mainGroupStore,a=e.currentUserId;return r.a.createElement(p.a,{container:!0,direction:"column"},r.a.createElement(s.a,null,r.a.createElement("b",null,"Google Calendar Events")),Y.a.values(e.calendarMeetings).map((function(e){var n=Y.a.values(e.users).filter((function(e){return!!e.currentMeeting}))[0],c=n&&n.currentMeeting?n.currentMeeting.meetingUrl:null;return r.a.createElement(p.a,{container:!0,direction:"row",spacing:2,justify:"flex-start",alignItems:"center"},r.a.createElement(p.a,{item:!0,style:{flexGrow:1}},r.a.createElement(p.a,{container:!0,direction:"row",justify:"flex-start",spacing:1,alignItems:"center"},r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{variant:"subtitle2"},e.meeting.eventName)),r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,{variant:"subtitle2"},se(new Date(e.meeting.startTime))+" - "+se(new Date(e.meeting.endTime))))),Y.a.values(e.users).map((function(e){return r.a.createElement(le,{mainGroupStore:t,user:e,isCurrentUser:e.userId===a,currentUser:t.state.appGroup.userIds[a],section:"calendar",showNextMeetingTime:!1})}))),c&&r.a.createElement(p.a,{item:!0},r.a.createElement(Ge.a,{color:"primary","aria-label":"join calendar meeting video call",href:c,target:"_blank"},r.a.createElement(xe.a,null))))})))},Oe=a(75);function Te(e){if(e){var t=Date.now();return e.filter((function(e){var a=new Date(e.endTime).getTime()>t,n=new Date(e.startTime).getTime();return a&&n<t}))[0]}return null}var Ae=function(e){var t=e.mainGroupStore,a=e.user.userId,n=function(e,t){var a=e.userIds,n=a[t],r=Object(k.a)(a,[t].map(P.a)),c=[n].concat(Object(Oe.a)(Y.a.values(r).sort())),o=Date.now(),u=c.reduce((function(e,t){return o-t.lastOnline>1.5*Ue?Object(m.a)({},e,Object(f.a)({},t.userId,t)):e}),{}),i=c.reduce((function(e,t){if(!u[t.userId]&&t.currentMeeting){var a=t.currentMeeting,n=e[a.meetingId],r=n?n.users:{};return Object(m.a)({},e,Object(f.a)({},a.meetingId,{meeting:a,users:Object(m.a)({},r,Object(f.a)({},t.userId,t))}))}return e}),{}),s=c.reduce((function(e,t){var a=!u[t.userId],n=Te(t.dailyCalendarEvents);if(a&&n){var r=e[n.id],c=r?r.users:{};return Object(m.a)({},e,Object(f.a)({},n.id,{meeting:n,users:Object(m.a)({},c,Object(f.a)({},t.userId,t))}))}return e}),{}),p=c.reduce((function(e,t){var a=!u[t.userId],n=!t.currentMeeting,r=!Te(t.dailyCalendarEvents),c="available"===t.availabilityStatus;return a&&n&&r&&c?Object(m.a)({},e,Object(f.a)({},t.userId,t)):e}),{}),l=c.reduce((function(e,t){var a=!u[t.userId],n=!t.currentMeeting,r=!Te(t.dailyCalendarEvents),c="busy"===t.availabilityStatus;return a&&n&&r&&c?Object(m.a)({},e,Object(f.a)({},t.userId,t)):e}),{});return{offline:u,video:i,calendar:s,available:p,busy:l}}(t.state.appGroup,a);return r.a.createElement(p.a,{container:!0,direction:"column",spacing:2,justify:"center"},r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,null,r.a.createElement("b",null,"Available")),Y.a.values(n.available).map((function(e){return r.a.createElement(le,{mainGroupStore:t,user:e,isCurrentUser:e.userId===a,currentUser:t.state.appGroup.userIds[a],section:"available",showNextMeetingTime:e.userId!==a})}))),r.a.createElement(p.a,{item:!0},r.a.createElement(be,{mainGroupStore:t,currentUserId:a,videoMeetings:n.video})),r.a.createElement(p.a,{item:!0},r.a.createElement(Se,{mainGroupStore:t,currentUserId:a,calendarMeetings:n.calendar})),r.a.createElement(p.a,{item:!0},r.a.createElement(s.a,null,r.a.createElement("b",null,"Offline")),Y.a.values(n.offline).map((function(e){return r.a.createElement(le,{mainGroupStore:t,user:e,isCurrentUser:e.userId===a,currentUser:t.state.appGroup.userIds[a],section:"offline",showNextMeetingTime:e.userId!==a})}))),r.a.createElement(p.a,{item:!0},r.a.createElement(H.a,null)))},Ue=6e4,je=function(e){var t=Object(n.useContext)(_),a=function(e){var t=Object(n.useReducer)(ee,{appGroup:e,lastCheckForMeetingUIUpdate:0}),a=Object(d.a)(t,2);return{state:a[0],dispatch:a[1]}}(e.appState.initialAppGroup);return r.a.useEffect((function(){re(e.appState.user.userId,a.state.appGroup.appGroupId);var t=setInterval((function(){re(e.appState.user.userId,a.state.appGroup.appGroupId)}),6e5);V.sendAlivePing(e.appState.user.userId,a.state.appGroup.appGroupId);var n,r,c=setInterval((function(){V.sendAlivePing(e.appState.user.userId,a.state.appGroup.appGroupId)}),Ue),o=(n=a.state.appGroup.appGroupId,r=a.dispatch,V.watchAppGroup(n,(function(e){r({type:"UPDATE_APP_GROUP",newAppGroup:e})}))),u=setInterval((function(){a.dispatch({type:"CHECK_FOR_MEETINGS_UI_UPDATE"})}),1e4);return function(){clearInterval(t),clearInterval(c),o(),clearInterval(u)}}),[]),r.a.createElement(p.a,{container:!0,direction:"column",justify:"center",alignItems:"flex-start",spacing:2},e.appState.popupsBlocked&&r.a.createElement(p.a,{item:!0,style:{width:"100%"}},r.a.createElement(s.a,{color:"error"},'Please "Always allow popups" in order to receive video calls.')),r.a.createElement(p.a,{item:!0,style:{width:"100%"}},r.a.createElement(we,{mainGroupStore:a,user:a.state.appGroup.userIds[e.appState.user.userId]})),r.a.createElement(p.a,{item:!0,style:{width:"100%"}},r.a.createElement(Ae,{mainGroupStore:a,user:a.state.appGroup.userIds[e.appState.user.userId]})),r.a.createElement(p.a,{item:!0,style:{width:"100%"}},r.a.createElement(Ie,{appStore:t,mainGroupStore:a,user:e.appState.user})))},_e=function(){switch(window.location.host){case"localhost:3006":return{CLOUD_FUNCTION_ENDPOINT:"http://localhost:8080"};case"pearcoco.com":return{CLOUD_FUNCTION_ENDPOINT:"https://us-central1-project-coco-production.cloudfunctions.net"};default:throw new Error("unknown window host:".concat(window.location.host))}},Ne=new Promise((function(e,t){L("logged_in")?(window.history.pushState({},document.title,J("logged_in")),e()):window.location.href="".concat(_e().CLOUD_FUNCTION_ENDPOINT,"/zoomGetTokenData?redirectUrl=").concat(window.location.href)})),Ce=function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(Ne);case 2:case"end":return e.stop()}}))};function ke(){var e,t;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(Ce());case 2:return a.next=4,i.a.awrap(fetch(_e().CLOUD_FUNCTION_ENDPOINT+"/loginUser",{credentials:"include"}));case 4:return e=a.sent,a.next=7,i.a.awrap(e.json());case 7:return t=a.sent,a.abrupt("return",t);case 9:case"end":return a.stop()}}))}var Pe=a(149);function De(e,t){return G.watchUser(e,(function(e){t({type:"UPDATE_USER",newUser:e})}))}var Re=a(26),Me=a(72);var Fe=function(){var e=function(){var e=Object(n.useReducer)(U,A),t=Object(d.a)(e,2);return{state:t[0],dispatch:t[1]}}();switch(e.state.view){case"initial":return function(e){var t,a,n,r,c;i.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,i.a.awrap(ke());case 2:return t=o.sent,u=t.config,I=u,o.next=6,i.a.awrap(x(t.customToken));case 6:return o.next=8,i.a.awrap(G.findOrCreateUser(t.user));case 8:if(a=o.sent,n=L("joinId"),!a.groupId){o.next=16;break}return o.next=13,i.a.awrap(V.getAppGroup(a.groupId));case 13:o.t0=o.sent,o.next=24;break;case 16:if(!n){o.next=22;break}return o.next=19,i.a.awrap(Z(a,n));case 19:o.t1=o.sent,o.next=23;break;case 22:o.t1=null;case 23:o.t0=o.t1;case 24:if(r=o.t0,De(a.userId,e.dispatch),!r){o.next=34;break}return V.updateUser(a,r.appGroupId),o.next=30,i.a.awrap(G.findOrCreateUser(t.user));case 30:c=o.sent,e.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:c,initialAppGroup:r,popupsBlocked:z()}}),o.next=35;break;case 34:e.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"joinGroup",user:a}});case 35:case"end":return o.stop()}var u}))}(e),r.a.createElement(l,null);case"loading":return r.a.createElement(l,null);case"joinGroup":return r.a.createElement(_.Provider,{value:e},r.a.createElement($,{appState:e.state}));case"mainGroup":return r.a.createElement(_.Provider,{value:e},r.a.createElement(je,{appState:e.state}));default:e.state;throw new Error("unknown state view")}},Le=(a(107),a(151)),Je=a(150),ze=a(55),Be=a(74),Ke=Object(Be.a)({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:ze.a.A400},background:{default:"#fff"}}});o.a.render(r.a.createElement(Je.a,{theme:Ke},r.a.createElement(Le.a,null),r.a.createElement((function(){return r.a.createElement(Pe.a,{maxWidth:"xs",style:{marginTop:"2em"}},r.a.createElement(Me.a,null,r.a.createElement("div",null,r.a.createElement(Re.a,{path:"/",component:Fe}))))}),null)),document.getElementById("root"))},83:function(e,t,a){e.exports=a(108)}},[[83,1,2]]]);
//# sourceMappingURL=main.37455528.chunk.js.map