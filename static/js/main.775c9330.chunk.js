(window["webpackJsonpdemo-react"]=window["webpackJsonpdemo-react"]||[]).push([[0],{53:function(e,t,r){e.exports=r(75)},75:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(11),u=r.n(o),c=r(4),p=r.n(c),i=r(9),s=r(110),l=function(){return a.a.createElement(s.a,null,"Loading")},f=r(25),d={view:"initial"};function w(e,t){switch(console.log("appStoreReducer previous state:",e),console.log("appStoreReducer",t),t.type){case"TRANSITION_APP_STATE":return r=t.newAppState,console.log("appStoreReducer computed state",r),r;default:t.type;return e}var r}var v=a.a.createContext(null);var O=r(14);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var h={joinId:""};function m(e,t){switch(console.log("joinGroupStoreReducer previous state:",e),console.log("joinGroupStoreReducer",t),t.type){case"UPDATE_JOIN_ID":return r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(r,!0).forEach(function(t){Object(O.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e,{joinId:t.newJoinId}),console.log("joinGroupStoreReducer computed state",r),r;default:t.type;return e}var r}a.a.createContext(null);var y=r(116),g=r(118),j=r(113),I=r(114),x=r(28),A=r.n(x);r(72);function G(){if(S)return S;throw new Error("firestoreDb not initialized")}function P(e){return E.apply(this,arguments)}function E(){return(E=Object(i.a)(p.a.mark(function e(t){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return A.a.initializeApp({apiKey:"AIzaSyD-Lhms0AxUKDuyccRdicHf6xUCIT-vB0A",authDomain:"project-coco-251813.firebaseapp.com",projectId:"project-coco-251813"}),e.next=3,A.a.auth().signInWithCustomToken(t).catch(function(e){var t=e.code,r=e.message;throw console.log("firestoreInitialize error",t,r),e});case 3:S=A.a.firestore();case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var S=null,T=function(e){return{get:function(){var t=Object(i.a)(p.a.mark(function t(r){var n,a;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=G().collection(e).doc(r),t.next=3,n.get();case 3:if(!(a=t.sent).exists){t.next=8;break}return t.abrupt("return",a.data());case 8:return t.abrupt("return",null);case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),set:function(){var t=Object(i.a)(p.a.mark(function t(r,n){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G().collection(e).doc(r).set(n);case 2:case"end":return t.stop()}},t)}));return function(e,r){return t.apply(this,arguments)}}(),update:function(){var t=Object(i.a)(p.a.mark(function t(r,n){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G().collection(e).doc(r).update(n);case 2:case"end":return t.stop()}},t)}));return function(e,r){return t.apply(this,arguments)}}(),delete:function(){var t=Object(i.a)(p.a.mark(function t(r){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G().collection(e).doc(r).delete();case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),watch:function(t,r){return G().collection(e).doc(t).onSnapshot(function(e){r(e.data())})}}};function k(e,t){for(var r="",n=0;n<e;n++)r+=t.charAt(Math.floor(Math.random()*t.length));return r}var N=T("appGroups"),_={watchAppGroup:function(e,t){return N.watch(e,t)},getAppGroup:function(){var e=Object(i.a)(p.a.mark(function e(t){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.get(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),getExistingAppGroup:function(){var e=Object(i.a)(p.a.mark(function e(t){var r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.get(t);case 2:if(!(r=e.sent)){e.next=7;break}return e.abrupt("return",r);case 7:throw new Error("getExistingAppGroup: group doesn't exist with id:"+t);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),deleteAppGroup:function(){var e=Object(i.a)(p.a.mark(function e(t){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.delete(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),createAppGroup:function(){var e=Object(i.a)(p.a.mark(function e(t){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.set(t.appGroupId,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),createNewAppGroup:function(){var e=Object(i.a)(p.a.mark(function e(t){var r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={appGroupId:"g"+(n=5,k(n,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")),userIds:Object(O.a)({},t.userId,{userId:t.userId,availabilityStatus:"available",currentMeeting:null,dailyCalendarEvents:{}})},e.next=3,N.set(r.appGroupId,r);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}var n},e)}));return function(t){return e.apply(this,arguments)}}(),userJoinExistingAppGroup:function(){var e=Object(i.a)(p.a.mark(function e(t,r){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(O.a)({},"userIds.".concat(t.userId),{userId:t.userId,availabilityStatus:"available",currentMeeting:null,dailyCalendarEvents:{}}),N.update(r,n),e.abrupt("return",_.getExistingAppGroup(r));case 3:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),removeUserFromAppGroup:function(){var e=Object(i.a)(p.a.mark(function e(t,r){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.update(t.appGroupId,Object(O.a)({},"userIds.".concat(r.userId),A.a.firestore.FieldValue.delete()));case 2:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()},D=T("users"),R={getUser:function(){var e=Object(i.a)(p.a.mark(function e(t){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.get(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),createUser:function(){var e=Object(i.a)(p.a.mark(function e(t){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.set(t.userId,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),findOrCreateUser:function(){var e=Object(i.a)(p.a.mark(function e(t){var r,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.getUser(t.id);case 2:if(!(r=e.sent)){e.next=7;break}return e.abrupt("return",r);case 7:return n={userId:t.id,groupId:null,displayName:t.first_name+" "+t.last_name,personalMeetingUrl:t.personal_meeting_url},e.next=10,D.set(n.userId,n);case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),updateGroup:function(){var e=Object(i.a)(p.a.mark(function e(t,r){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.update(t,{groupId:r});case 2:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()},U=r(47),C=r.n(U),J={createGroup:function(){var e=Object(i.a)(p.a.mark(function e(t){var r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.createNewAppGroup(t);case 2:return r=e.sent,e.next=5,R.updateGroup(t.userId,r.appGroupId);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),userTryJoinGroup:function(){var e=Object(i.a)(p.a.mark(function e(t,r){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.getAppGroup(r);case 2:if(!e.sent){e.next=12;break}return e.next=6,_.userJoinExistingAppGroup(t,r);case 6:return n=e.sent,e.next=9,R.updateGroup(t.userId,r);case 9:return e.abrupt("return",n);case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),userLeaveGroup:function(){var e=Object(i.a)(p.a.mark(function e(t,r){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.updateGroup(t.userId,null);case 2:return e.next=4,_.removeUserFromAppGroup(r,t);case 4:return e.next=6,_.getAppGroup(r.appGroupId);case 6:if(!(n=e.sent)||!n.userIds||0!==C.a.values(n.userIds).length){e.next=10;break}return e.next=10,_.deleteAppGroup(n.appGroupId);case 10:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()};function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(r,!0).forEach(function(t){Object(O.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var F=function(e){var t=Object(n.useContext)(v),r=function(){var e=Object(n.useReducer)(m,h),t=Object(f.a)(e,2);return{state:t[0],dispatch:t[1]}}();return a.a.createElement(j.a,{container:!0,direction:"column",justify:"center",alignItems:"center",spacing:5},a.a.createElement(j.a,{item:!0},a.a.createElement(j.a,{container:!0,direction:"row",justify:"center",alignItems:"center",spacing:2},a.a.createElement(j.a,{item:!0},a.a.createElement(y.a,{label:"Group Id",margin:"normal",variant:"outlined",value:r.state.joinId,onChange:function(e){r.dispatch({type:"UPDATE_JOIN_ID",newJoinId:e.target.value})}})),a.a.createElement(j.a,{item:!0},a.a.createElement(g.a,{color:"primary",variant:"contained",onClick:Object(i.a)(p.a.mark(function n(){var a;return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),n.next=3,J.userTryJoinGroup(e.appState.user,r.state.joinId);case 3:(a=n.sent)?t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:L({},e.appState.user,{groupId:a.appGroupId}),initialAppGroup:a}}):(t.dispatch({type:"TRANSITION_APP_STATE",newAppState:e.appState}),console.log("group doesn't exist"));case 5:case"end":return n.stop()}},n)}))},"Join")))),a.a.createElement(I.a,{variant:"middle"}),a.a.createElement(j.a,{item:!0},a.a.createElement(g.a,{color:"secondary",variant:"contained",onClick:Object(i.a)(p.a.mark(function r(){var n;return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),r.next=3,J.createGroup(e.appState.user);case 3:n=r.sent,t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:L({},e.appState.user,{groupId:n.appGroupId}),initialAppGroup:n}});case 5:case"end":return r.stop()}},r)}))},"Create Group")))};function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function B(e,t){switch(console.log("mainGroupStoreReducer previous state:",e),console.log("mainGroupStoreReducer",t),t.type){case"UPDATE_APP_GROUP":return r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(r,!0).forEach(function(t){Object(O.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e,{appGroup:t.newAppGroup}),console.log("mainGroupStoreReducer computed state",r),r;default:t.type;return e}var r}a.a.createContext(null);function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(r,!0).forEach(function(t){Object(O.a)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var V,W=function(e){var t=Object(n.useContext)(v),r=function(e){var t=Object(n.useReducer)(B,{appGroup:e}),r=Object(f.a)(t,2);return{state:r[0],dispatch:r[1]}}(e.appState.initialAppGroup);return a.a.useEffect(function(){var e,t,n=(e=r.state.appGroup.appGroupId,t=r.dispatch,_.watchAppGroup(e,function(e){t({type:"UPDATE_APP_GROUP",newAppGroup:e})}));return function(){n()}},[]),a.a.createElement(j.a,{container:!0,direction:"column",justify:"center",alignItems:"center",spacing:5},a.a.createElement(j.a,{item:!0},a.a.createElement(s.a,null,"GroupId: ",r.state.appGroup.appGroupId),a.a.createElement("pre",null,JSON.stringify(r.state.appGroup,null,2))),a.a.createElement(j.a,{item:!0},a.a.createElement(g.a,{variant:"contained",color:"secondary",onClick:Object(i.a)(p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"loading"}}),n.next=3,J.userLeaveGroup(e.appState.user,r.state.appGroup);case 3:t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"joinGroup",user:H({},e.appState.user,{groupId:null})}});case 4:case"end":return n.stop()}},n)}))},"Leave Group")))},q=function(e){var t=new RegExp(e+"=(.*?)($|&)","g"),r=decodeURIComponent(window.location.search).match(t);return r&&r.length?r[0].replace(e+"=","").replace("&",""):null},Q=function(){switch(window.location.host){case"localhost:3006":return{CLOUD_FUNCTION_ENDPOINT:"http://localhost:8080"};case"solomonlake.github.io":return{CLOUD_FUNCTION_ENDPOINT:"https://us-central1-project-coco-251813.cloudfunctions.net"};default:throw new Error("unknown window host:".concat(window.location.host))}},X={initialize:function(){return V=new Promise(function(e,t){var r=q("zoom_token_data");if(r){var n=JSON.parse(decodeURIComponent(r));window.history.pushState({},document.title,window.location.origin+window.location.pathname),e(n)}else window.location.href=Q().CLOUD_FUNCTION_ENDPOINT+"/zoomGetTokenData"})},getToken:function(){return V||X.initialize()}};function Y(){return Z.apply(this,arguments)}function Z(){return(Z=Object(i.a)(p.a.mark(function e(){var t,r,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getToken();case 2:return t=e.sent,e.next=5,fetch(Q().CLOUD_FUNCTION_ENDPOINT+"/loginUser?zoomTokenData=".concat(encodeURIComponent(JSON.stringify(t))));case 5:return r=e.sent,e.next=8,r.json();case 8:return n=e.sent,console.log("response",n),e.abrupt("return",n);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $(){return($=Object(i.a)(p.a.mark(function e(t){var r,n,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return X.initialize(),e.next=3,Y();case 3:return r=e.sent,e.next=6,P(r.customToken);case 6:return e.next=8,R.findOrCreateUser(r.user);case 8:if(!(n=e.sent).groupId){e.next=15;break}return e.next=12,_.getAppGroup(n.groupId);case 12:e.t0=e.sent,e.next=16;break;case 15:e.t0=null;case 16:a=e.t0,n.groupId&&a?t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"mainGroup",user:n,initialAppGroup:a}}):t.dispatch({type:"TRANSITION_APP_STATE",newAppState:{view:"joinGroup",user:n}});case 18:case"end":return e.stop()}},e)}))).apply(this,arguments)}r(74);var ee=r(119),te=r(115),re=r(35),ne=r(48),ae=Object(ne.a)({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:re.a.A400},background:{default:"#fff"}}});u.a.render(a.a.createElement(te.a,{theme:ae},a.a.createElement(ee.a,null),a.a.createElement(function(){var e=function(){var e=Object(n.useReducer)(w,d),t=Object(f.a)(e,2);return{state:t[0],dispatch:t[1]}}();switch(e.state.view){case"initial":return function(e){$.apply(this,arguments)}(e),a.a.createElement(l,null);case"loading":return a.a.createElement(l,null);case"joinGroup":return a.a.createElement(v.Provider,{value:e},a.a.createElement(F,{appState:e.state}));case"mainGroup":return a.a.createElement(v.Provider,{value:e},a.a.createElement(W,{appState:e.state}));default:e.state;throw new Error("unknown state view")}},null)),document.getElementById("root"))}},[[53,1,2]]]);
//# sourceMappingURL=main.775c9330.chunk.js.map